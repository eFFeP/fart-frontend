<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Smart TP</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="menu-icon" onclick="toggleMenu()">â˜°</div>

    <nav class="menu" id="sideMenu">
        <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">Profilo</a></li>
             <li id="adminPanelLink" style="display: none;"><a href="admin-panel.html">Pannello Amministrativo</a></li>
            <li><a href="#" id="logout">Logout</a></li>
        </ul>
    </nav>

    <div class="container">
       <h1 id="welcomeMessage"></h1>
        <p id="userDetails" style="font-size: 0.9em;"></p>
    </div>

    <script>
        function toggleMenu() {
            const menu = document.getElementById('sideMenu');
            menu.classList.toggle('open');
        }

         function logout() {
            localStorage.removeItem('token');
            window.location.href = 'index.html';
        }

        document.getElementById('logout').addEventListener('click', logout);

        let inactivityTimer;

        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(logout, 10 * 60 * 1000); // 10 minuti
        }

        ['click', 'touchstart', 'mousemove'].forEach(evt => 
            document.addEventListener(evt, resetInactivityTimer, false)
        );

        document.addEventListener('DOMContentLoaded', function() {
            resetInactivityTimer();
          
        });
        function loadUserInfo() {
            const token = localStorage.getItem('token');
            fetch('https://autisti.onrender.com/user-profile', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(user => {
                document.getElementById('welcomeMessage').textContent = `Benvenuto ${user.username}`;
                document.getElementById('userDetails').textContent = `${user.ditta} - ${user.settore.charAt(0).toUpperCase()}${user.matricola} - ${user.deposito}`;
           // Mostra il link al pannello amministrativo solo per admin e superadmin
                if (user.role === 'admin' || user.role === 'superadmin') {
                    document.getElementById('adminPanelLink').style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Errore nel caricamento delle informazioni utente:', error);
            });
        }

        document.addEventListener('DOMContentLoaded', loadUserInfo);
    </script>
</body>
</html>
